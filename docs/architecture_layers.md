# åˆ†å±‚æ¶æ„é‡æ„è¯´æ˜

## ğŸ—ï¸ æ–°çš„åˆ†å±‚æ¶æ„

é‡æ„åçš„é¡¹ç›®é‡‡ç”¨äº†æ ‡å‡†çš„å››å±‚æ¶æ„æ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Handler Layer â”‚  â† HTTPå¤„ç†å±‚ (Controllers)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Service Layer â”‚  â† ä¸šåŠ¡é€»è¾‘å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Repository Layer â”‚  â† ä»“å‚¨æŠ½è±¡å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     DAO Layer   â”‚  â† æ•°æ®è®¿é—®å¯¹è±¡å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Database Layer â”‚  â† æ•°æ®åº“è¿æ¥å±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ç›®å½•ç»“æ„

```
internal/
â”œâ”€â”€ api/handlers/        # Handler Layer - HTTPè¯·æ±‚å¤„ç†
â”œâ”€â”€ services/           # Service Layer - ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ repository/         # Repository Layer - ä»“å‚¨æŠ½è±¡
â”œâ”€â”€ dao/               # DAO Layer - æ•°æ®è®¿é—®å¯¹è±¡
â”œâ”€â”€ database/          # Database Layer - æ•°æ®åº“è¿æ¥ç®¡ç†
â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â””â”€â”€ utils/             # å·¥å…·ç±»
```

## ğŸ”„ å„å±‚èŒè´£

### 1. Handler Layer (APIå±‚)
- **ä½ç½®**: `internal/api/handlers/`
- **èŒè´£**:
  - å¤„ç†HTTPè¯·æ±‚å’Œå“åº”
  - å‚æ•°éªŒè¯å’Œæ•°æ®ç»‘å®š
  - è°ƒç”¨Serviceå±‚å¤„ç†ä¸šåŠ¡é€»è¾‘
  - é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç è®¾ç½®

### 2. Service Layer (æœåŠ¡å±‚)
- **ä½ç½®**: `internal/services/`
- **èŒè´£**:
  - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¤„ç†
  - æ•°æ®éªŒè¯å’Œä¸šåŠ¡è§„åˆ™æ£€æŸ¥
  - äº‹åŠ¡ç®¡ç†
  - è°ƒç”¨Repositoryå±‚è¿›è¡Œæ•°æ®æ“ä½œ

### 3. Repository Layer (ä»“å‚¨å±‚)
- **ä½ç½®**: `internal/repository/`
- **èŒè´£**:
  - æä¾›æ•°æ®è®¿é—®çš„æŠ½è±¡æ¥å£
  - ä¸šåŠ¡ç›¸å…³çš„æ•°æ®ç»„åˆå’Œå¤„ç†
  - è°ƒç”¨DAOå±‚è¿›è¡Œå…·ä½“æ•°æ®æ“ä½œ
  - æ•°æ®æ¨¡å‹çš„ä¸šåŠ¡é€»è¾‘åŒ…è£…

### 4. DAO Layer (æ•°æ®è®¿é—®å¯¹è±¡å±‚)
- **ä½ç½®**: `internal/dao/`
- **èŒè´£**:
  - ç›´æ¥çš„æ•°æ®åº“æ“ä½œ (CRUD)
  - SQLæŸ¥è¯¢çš„å°è£…
  - æ•°æ®åº“äº‹åŠ¡å¤„ç†
  - åŸå§‹æ•°æ®çš„è¯»å†™

### 5. Database Layer (æ•°æ®åº“å±‚)
- **ä½ç½®**: `internal/database/`
- **èŒè´£**:
  - æ•°æ®åº“è¿æ¥ç®¡ç†
  - è¿æ¥æ± é…ç½®
  - æ•°æ®åº“åˆå§‹åŒ–

## ğŸŒŠ æ•°æ®æµå‘

### è¯·æ±‚æµå‘ (ä¸‹è¡Œ)
```
HTTP Request â†’ Handler â†’ Service â†’ Repository â†’ DAO â†’ Database
```

### å“åº”æµå‘ (ä¸Šè¡Œ)
```
Database â†’ DAO â†’ Repository â†’ Service â†’ Handler â†’ HTTP Response
```

## ğŸ”§ ä¾èµ–æ³¨å…¥

å®¹å™¨ (`cmd/server/container.go`) ä¸­çš„åˆå§‹åŒ–é¡ºåºï¼š

```go
1. initUtils()         // å·¥å…·ç±»åˆå§‹åŒ–
2. initDAOs()         // DAOå±‚åˆå§‹åŒ–
3. initRepositories() // Repositoryå±‚åˆå§‹åŒ–
4. initServices()     // Serviceå±‚åˆå§‹åŒ–
5. initMiddleware()   // ä¸­é—´ä»¶åˆå§‹åŒ–
6. initHandlers()     // Handlerå±‚åˆå§‹åŒ–
```

## âœ… é‡æ„ä¼˜åŠ¿

1. **èŒè´£åˆ†ç¦»**: æ¯å±‚æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œ
2. **å¯æµ‹è¯•æ€§**: å„å±‚å¯ä»¥ç‹¬ç«‹è¿›è¡Œå•å…ƒæµ‹è¯•
3. **å¯ç»´æŠ¤æ€§**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
4. **å¯æ‰©å±•æ€§**: æ–°å¢åŠŸèƒ½æ—¶å¯ä»¥æŒ‰å±‚æ¬¡æ·»åŠ 
5. **å¤ç”¨æ€§**: DAOå±‚çš„æ–¹æ³•å¯ä»¥è¢«å¤šä¸ªRepositoryå¤ç”¨
6. **è§£è€¦**: ä¸Šå±‚ä¸ç›´æ¥ä¾èµ–æ•°æ®åº“ï¼Œé€šè¿‡æ¥å£æŠ½è±¡

## ğŸ¯ Contextæ”¯æŒ

æ‰€æœ‰å±‚éƒ½æ”¯æŒ `context.Context`ï¼Œå®ç°ï¼š
- è¯·æ±‚è¶…æ—¶æ§åˆ¶
- è¯·æ±‚å–æ¶ˆæœºåˆ¶
- åˆ†å¸ƒå¼è¿½è¸ª
- èµ„æºæ¸…ç†

## ğŸ“ ç¤ºä¾‹

### Handlerè°ƒç”¨Service
```go
user, err := h.authService.GetProfile(c.Request.Context(), userID)
```

### Serviceè°ƒç”¨Repository
```go
user, err := s.userRepo.GetByID(ctx, userID)
```

### Repositoryè°ƒç”¨DAO
```go
user, err := r.userDAO.SelectByID(ctx, userID)
```

è¿™ç§åˆ†å±‚æ¶æ„ç¬¦åˆä¼ä¸šçº§åº”ç”¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œæä¾›äº†è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚
