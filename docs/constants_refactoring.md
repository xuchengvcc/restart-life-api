# 常量包重构文档

## 📋 重构概述

将原来的单一常量文件 `constants.go` 按功能模块拆分为多个文件，提高代码的可维护性和可读性。

## 🗂️ 新的文件结构

```
internal/constants/
├── api.go         # API相关常量（路由、状态码、限制等）
├── character.go   # 角色相关常量（属性、状态、生活阶段等）
├── database.go    # 数据库相关常量（分页、时间、缓存、表名等）
├── errors.go      # 错误代码和消息常量
├── game.go        # 游戏核心常量（规则、事件、难度等）
├── http.go        # HTTP相关常量（Headers、JWT、上下文、日志等）
└── user.go        # 用户相关常量（密码、验证、状态等）
```

## 📁 各文件详细内容

### errors.go - 错误管理
- **错误代码**: 按模块分类（1xxx认证、2xxx业务、3xxx角色、4xxx游戏）
- **响应消息**: 统一的错误提示信息
- **用途**: 统一错误处理和国际化支持

### http.go - HTTP通信
- **HTTP Headers**: Authorization、Content-Type、Request-ID等
- **JWT常量**: Bearer前缀、Token类型
- **上下文键**: 请求ID、用户ID、Claims等
- **日志字段**: 标准化的日志记录字段

### user.go - 用户管理
- **密码规则**: 长度限制、加密成本
- **用户限制**: 用户名、邮箱、简介长度
- **用户状态**: 激活、禁用、删除等状态
- **性别枚举**: 标准化的性别选项

### character.go - 角色系统
- **角色限制**: 名称长度、年龄范围、属性值范围
- **种族类型**: 支持的角色种族选项
- **属性常量**: 智力、体质、魅力等属性名称
- **生活阶段**: 婴儿、青少年、成年等阶段划分

### game.go - 游戏逻辑
- **游戏规则**: 开始年龄、寿命限制、属性变化
- **事件系统**: 事件类型、影响类型
- **游戏模式**: 难度设置、生活模式
- **基础数据**: 国家、教育、婚姻状况等

### database.go - 数据存储
- **分页设置**: 默认页大小、最大页大小
- **时间配置**: Token过期时间、会话超时
- **缓存策略**: 缓存键前缀、TTL设置
- **数据库表**: 标准化的表名常量

### api.go - 接口规范
- **API版本**: 版本号和路径前缀
- **路由定义**: 标准化的API路由常量
- **限制设置**: 请求频率、并发限制
- **内容类型**: 支持的Content-Type

## 🔄 迁移过程

### 1. 原文件分析
- 识别了原 `constants.go` 中的所有常量
- 按功能模块进行分类
- 确保没有遗漏或重复

### 2. 新文件创建
- 创建7个专门的常量文件
- 每个文件专注于特定功能领域
- 保持一致的命名和注释风格

### 3. 代码更新
- 更新所有引用常量的代码文件
- 确保import路径正确
- 修复编译错误

### 4. 测试验证
- 编译通过：✅
- 单元测试通过：✅
- 功能完整性确认：✅

## 📈 重构收益

### 代码组织
- **模块化**: 常量按功能分组，易于定位和维护
- **可读性**: 每个文件专注于特定领域，降低认知负担
- **可扩展**: 新功能的常量可以独立添加到对应文件

### 开发效率
- **快速定位**: 开发者可以快速找到相关常量
- **减少冲突**: 团队协作时减少文件冲突
- **便于重构**: 某个模块的常量变更不影响其他模块

### 维护性
- **单一职责**: 每个文件只负责特定类型的常量
- **易于扩展**: 新增常量类型时可以创建新文件
- **版本控制**: Git历史记录更清晰，便于追踪变更

## 🛠️ 使用建议

### 导入规范
```go
import (
    "github.com/xuchengvcc/restart-life-api/internal/constants"
)

// 使用示例
constants.ErrCodeInvalidCredentials
constants.HeaderAuthorization
constants.TokenTypeAccess
```

### 新增常量
1. 确定常量的功能分类
2. 在对应的文件中添加
3. 保持命名一致性
4. 添加适当的注释

### 命名约定
- **错误代码**: `ErrCode` + 具体错误
- **消息常量**: `Msg` + 具体消息
- **状态常量**: `Status` + 具体状态
- **类型常量**: 直接使用描述性名称

## 🔮 未来改进

1. **国际化支持**: 将消息常量扩展为多语言支持
2. **配置化**: 部分常量可以从配置文件读取
3. **验证器**: 添加常量值的验证函数
4. **文档生成**: 自动生成常量文档

---

这次重构提高了代码的组织性和可维护性，为项目的长期发展奠定了良好基础。
